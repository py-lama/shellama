# Makefile dla projektu Spyq

.PHONY: help install install-dev test test-cov clean build upload upload-test lint format check docs

# DomyÅ›lny cel
help:
	@echo "ðŸ”§ Spyq - Python Validator Proxy"
	@echo "================================="
	@echo ""
	@echo "DostÄ™pne komendy:"
	@echo "  install      - Instalacja paczki"
	@echo "  install-dev  - Instalacja w trybie deweloperskim"
	@echo "  test         - Uruchom testy"
	@echo "  test-cov     - Uruchom testy z pokryciem kodu"
	@echo "  lint         - SprawdÅº jakoÅ›Ä‡ kodu (flake8, mypy)"
	@echo "  format       - Formatuj kod (black)"
	@echo "  check        - SprawdÅº wszystko (lint + test)"
	@echo "  clean        - WyczyÅ›Ä‡ pliki tymczasowe"
	@echo "  build        - Zbuduj paczkÄ™"
	@echo "  upload-test  - WyÅ›lij na TestPyPI"
	@echo "  upload       - WyÅ›lij na PyPI"
	@echo "  docs         - Generuj dokumentacjÄ™"

# Instalacja
install:
	@echo "ðŸ“¦ Instalowanie Spyq..."
	pip install .

install-dev:
	@echo "ðŸ”§ Instalowanie w trybie deweloperskim..."
	pip install -e ".[dev]"

# Testy
test:
	@echo "ðŸ§ª Uruchamianie testÃ³w..."
	python -m pytest tests/ -v

test-cov:
	@echo "ðŸ§ª Uruchamianie testÃ³w z pokryciem kodu..."
	python -m pytest tests/ -v --cov=spyq --cov-report=html --cov-report=term

# JakoÅ›Ä‡ kodu
lint:
	@echo "ðŸ” Sprawdzanie jakoÅ›ci kodu..."
	@echo "â†’ flake8..."
	python -m flake8 spyq tests
	@echo "â†’ mypy..."
	python -m mypy spyq

format:
	@echo "âœ¨ Formatowanie kodu..."
	python -m black spyq tests

check: lint test
	@echo "âœ… Wszystkie sprawdzenia zakoÅ„czone pomyÅ›lnie!"

# Czyszczenie
clean:
	@echo "ðŸ§¹ Czyszczenie plikÃ³w tymczasowych..."
	rm -rf build/
	rm -rf dist/
	rm -rf *.egg-info/
	rm -rf htmlcov/
	rm -rf .pytest_cache/
	rm -rf .mypy_cache/
	rm -rf .coverage
	find . -type d -name __pycache__ -exec rm -rf {} +
	find . -type f -name "*.pyc" -delete
	find . -type f -name "*.pyo" -delete

# Budowanie
build: clean
	@echo "ðŸ—ï¸  Budowanie paczki..."
	python -m pip install --upgrade build
	python -m build

# Upload
upload-test: build
	@echo "ðŸ“¤ WysyÅ‚anie na TestPyPI..."
	python -m pip install --upgrade twine
	python -m twine upload --repository testpypi dist/*

upload: build
	@echo "ðŸ“¤ WysyÅ‚anie na PyPI..."
	python -m pip install --upgrade twine
	python -m twine upload dist/*

# Dokumentacja
docs:
	@echo "ðŸ“š Generowanie dokumentacji..."
	@echo "README.md jest gÅ‚Ã³wnÄ… dokumentacjÄ…"
	@echo "Dodatkowa dokumentacja moÅ¼e byÄ‡ dodana w przyszÅ‚oÅ›ci"

# Sprawdzenie Å›rodowiska
env-check:
	@echo "ðŸ” Sprawdzanie Å›rodowiska..."
	@echo "Python: $(shell python --version)"
	@echo "Pip: $(shell pip --version)"
	@echo "Lokalizacja Python: $(shell which python)"
	@echo "Lokalizacja Pip: $(shell which pip)"

# Instalacja z aliasem
install-with-alias: install
	@echo "ðŸ”— Konfigurowanie aliasu..."
	@bash install.sh

# Quick start dla deweloperÃ³w
dev-setup: install-dev
	@echo "ðŸš€ Konfiguracja Å›rodowiska deweloperskiego zakoÅ„czona!"
	@echo ""
	@echo "NastÄ™pne kroki:"
	@echo "1. make test      # Uruchom testy"
	@echo "2. make format    # Sformatuj kod"
	@echo "3. make check     # SprawdÅº wszystko"

# Pre-commit hook
pre-commit: format lint test
	@echo "âœ… Pre-commit sprawdzenia zakoÅ„czone pomyÅ›lnie!"

# Informacje o projekcie
info:
	@echo "ðŸ“Š Informacje o projekcie Spyq"
	@echo "=============================="
	@echo "Wersja: $(shell python -c "import spyq; print(spyq.__version__)" 2>/dev/null || echo 'Nie zainstalowane')"
	@echo "Lokalizacja: $(shell python -c "import spyq; print(spyq.__file__)" 2>/dev/null || echo 'Nie zainstalowane')"
	@echo "Python: $(shell python --version)"
	@echo "Pliki projektu:"
	@find . -name "*.py" | head -10
	@echo "Linie kodu:"
	@find . -name "*.py" -not -path "./build/*" -not -path "./dist/*" | xargs wc -l | tail -1